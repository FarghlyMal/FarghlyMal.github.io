---
title: "Medusa Ransomware detection"
classes: wide
header:
  teaser: https://miro.medium.com/v2/resize:fit:720/format:webp/1*Wkcm0K0-7-GH0t69MmTAHw.jpeg
ribbon: DodgerBlue
description: "In this small article, i will explain how to write a Yara rule for Medusa Ransomware"
categories:
  - Malware Analysis
toc: true
---

# Introduction

Medusa is RansomWare that will run specific tasks to prepare the target system for the encryption of files, Medusa was first seen in 2019, Medusa avoids executable files, probably to avoid rendering the targeted system unusable for paying the ransom, Medusa Locker has been known to exploit Remote Desktop Protocol (RDP) vulnerabilities to gain access to a victim’s machine, It uses a combination of AES and RSA-2048, and reportedly appends extensions such as .encrypted, .bomber, .boroff, .breakingbad, .locker16, .newlock, .nlocker, and .skynet.

# How To Do it

I will use IDA Pro as my tool to help me with this project, first one of the most things that identify a sample or a family of Malware is _Strings,_ looking at strings gives us a lot of options to include in our yara rule

![](https://miro.medium.com/v2/resize:fit:875/1*AHkHJzNX2Dfv_wM1rQ5_LA.png)

strings

the malware uses a removed **_PrintF in C++,_**  the second string is a string, so we need to take a look at all strings we get some useful ones

![](https://miro.medium.com/v2/resize:fit:875/1*YMdjx5AD3jF0rkkFDk9czA.png)

> **“ {8761ABBD-7F85–42EE-B272-A76179687C63} ”**
> 
> **“ [LOCKER] Is running ”**
> 
> **“ vssadmin.exe Delete Shadows /All /Quiet ”**
> 
> **“ bcdedit.exe /set {default} recoveryenabled No”**
> 
> **‘ wbadmin DELETE SYSTEMSTATEBACKUP -deleteOldest ’**

and I have another sample that is 64 bit, I need to explore it

![](https://miro.medium.com/v2/resize:fit:875/1*iY5fRae4hXbCjzEXe8bLyA.png)

64-bit strings

> **“vssadmin.exe Delete Shadows /All /Quiet”**
> 
> **“bcdedit.exe /set {default} recoveryenabled No”**
> 
> **“wbadmin DELETE SYSTEMSTATEBACKUP”**

so let’s build our rule to detect this family
 ```python
rule Medusa_locker{  
    meta:  
        Description = "This is a simple powerful rule to detect Medusa Locker"  
        author      = "AzizMal --> Farghly.mahmoud66@outlook.com"  
        Data        = "13/4/2023"  
        cape_type   = "MedusaLocker Payload"  
   
          
    strings:  
        $S1 = "bcdedit.exe /set {default} recoveryenabled No" wide  
        $S2 = "bcdedit.exe /set {default} bootstatuspolicy ignorea" wide  
        $S3 = "bcdedit.exe /set {default} recoveryenab" wide  
        $S4 = "wbadmin DELETE SYSTEMSTATEBACKUP -deleteOldest" wide  
        $S5 = "wmic.exe SHADOWCOPY /nointeractive" wide  
        $S6 = "[LOCKER] Run scanning..." wide  
        $S7 = "[LOCKER] Stop and delete services" wide  
        $S8 = "{8761ABBD-7F85-42EE-B272-A76179687C63}" wide  
        $S9 = "[LOCKER] Sleep at 60 seconds..." wide  
      
    condition:  
        uint16(0) == 0x5A4D and 5 of ($S*)   
}
```
I have 4 samples and I will test them, then I will use an online sandbox to scan a wide range of samples , and here is the result bro

![](https://miro.medium.com/v2/resize:fit:875/1*_6F9cIetYv2M564dhzE7Gg.png)

local scanning

using [**hybrid-analysis.com**](https://www.hybrid-analysis.com/yara-search/results/137e18a84891d727543efd48ea8e444bbf65f960890dcb149d02daee6d07b487) **we got awsom results**

![](https://miro.medium.com/v2/resize:fit:875/1*4VfvYQQgFkjDBLmczvyt9g.png)

more detection (60 sample) in the sandbox give us how the yara is good, and here is the link if u want to check [**_click here_**](https://www.hybrid-analysis.com/yara-search/results/137e18a84891d727543efd48ea8e444bbf65f960890dcb149d02daee6d07b487)

![](https://miro.medium.com/v2/resize:fit:875/1*GkIx9y2I0e_SIWmfh05_nA.png)

thanks for reading -_-

**thanks for** [**MalGamy**](https://github.com/MalGamy)

follow me

[**_LinkedIn_**](https://www.linkedin.com/in/aziz-farghly-9133501a4)

[**_Twitter_**](https://twitter.com/FarghlyMal)
